
{% extends ':Layout:layout2.html.twig' %}

{% block descripcion_y_acciones %}

{% endblock %}
{% block js_extend %}
    <link rel="stylesheet" href="{{ asset('Resources/lobibox-master/dist/css/lobibox.min.css')}}">
            <link rel="stylesheet" href="{{ asset('Resources/sweetalert-master/dist/sweetalert.css')}}"> 

    <script src = "{{ asset('Resources/js/tipoempresa/tipoempresa.js') }}"  type = "text/javascript" ></script>

    <script src = "{{ asset('Resources/js/empresa/function.js') }}"  type = "text/javascript" ></script>    
    <script src = "{{ asset('Resources/Empresa/globalfunction.js') }}"  type = "text/javascript" ></script> 
    <script src = "{{ asset('Resources/vContra/strength.js') }}"  type = "text/javascript" ></script>
    <script src = "{{ asset('Resources/vContra/js.js') }}"  type = "text/javascript" ></script> 

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link rel="stylesheet" href="{{asset('Resources/AdminLTE-2.3.0/dist/css/AdminLTE.min.css')}}">
    <link rel="stylesheet" href="{{asset('Resources/AdminLTE-2.3.0/plugins/iCheck/square/blue.css')}}">
    <link href="{{asset('Resources/src/css/menu_movil.css')}}" rel="stylesheet">
    {# <link rel="stylesheet" media="screen" type="text/css" href="{{ asset('Resources/colorpicker/css/colorpicker.css') }}" />
    <script type="text/javascript" src="{{ asset('Resources/colorpicker/js/colorpicker.js') }}"></script>#}

    <link href="{{asset('Resources/jquery-validation-1.15.0/demo/css/screen.css')}}" rel="stylesheet">
    <script src="{{ asset('Resources/jquery-validation-1.15.0/dist/jquery.validate.js')}}"></script>
    <script src="{{ asset('Resources/sweetalert-master/dist/sweetalert.min.js') }}"></script>

    <script type = "text/javascript" >
        $(document).on('ready', function () {
            $("#frmEmpresaUsuarioPersona").validate({
            });
        });
    </script>  
{% endblock %} 
{% block navegacion_Y_body %}
{% block navegacion %}{% endblock %}
{% block cuerpo %}
    <div id="page-content">
        <div class="container">
            <div class="row">
                <div class="col-md-12">
                    <h2 style="color: black;" class="text-center">Registro de abogados</h2>
                </div>
                <form id="frmEmpresaUsuarioPersona" >
                    <div class="clearfix"></div>
                    <div class="col-md-12" style="margin-top: -35px;">
                        <!-- general form elements -->
                        <div class="login-box">
                            <div class="login-box-body" style="box-shadow: 3px 3px 2px #888888;">
                                <p class="login-box-msg text-success" style="font-size: 1.17em;">Ingreso de datos generales</p>
                                <div class="form-group has-feedback">
                                    <label for="nombreEmpleado">Nombres</label>
                                    <input type="text" required class="form-control" id="txtnombre" name="txtnombre" placeholder="Nombres" data-rule-required="true" >
                                    <span class="glyphicon glyphicon-user form-control-feedback"></span>
                                </div>
                                <div class="form-group has-feedback">
                                    <label for="ejemplo_password_1">Apellidos</label>
                                    <input type="text" required class="form-control"  id="txtapellido" name="txtapellido" placeholder="Apellidos" data-rule-required="true" >
                                    <span class="glyphicon glyphicon-user form-control-feedback"></span>
                                </div>
                                <div class="form-group has-feedback">
                                    <label for="correoEmpresa">Correo electronico :</label>
                                    <input type="email" class="form-control correo" id="correoEmpresa" name="correoEmpresa" data-rule-email="true"  required placeholder="ejemplo@ejemplo.com" >
                                    <span class="glyphicon glyphicon-envelope form-control-feedback"></span>
                                </div>
                                <div class="form-group has-feedback">
                                    <label for="correoEmpresa">Contraseña:</label>
                                    <input type="password" required class="form-control" id="contrasenha" name="contrasenha" placeholder="Contraseña" data-rule-required="true" >
                                    <span class="glyphicon glyphicon-lock form-control-feedback"></span>
                                </div>
                                <div class="form-group">
                                    <button  type="submit" class="btn btn-primary btn-flat" onClick="enviar()" id="bntenviar" data-loading-text="<i class='fa fa-circle-o-notch fa-spin'></i> Enviando">Registrarme</button>
                                   {# <a href="{{ path('abogado_login') }}" class="button">
                                        <button class="btn btn-social btn-facebook btn-flat" style="background-color: #3a5795; color: #FFFFFF"><i class="fa fa-facebook"></i> Conectar con Facebook</button>
                                    </a>#}
                                   <div  style="margin-left:125px;margin-top:-30px;">
                                        <fb:login-button size="large" scope="public_profile,email" onlogin="checkLoginState();">
                                             Registrarme con Facebook
                                        </fb:login-button>
                                   </div>
                                   
                                </div>
                            </div>
                        </div>
                    </div>
                </form>  
            </div> 
        </div> 
    </div> 
    <script src="{{asset('Resources/AdminLTE-2.3.0/plugins/jQuery/jQuery-2.1.4.min.js')}}"></script>
    <script src="{{ asset('Resources/lobibox-master/dist/js/lobibox.min.js') }}"></script>
    <script src="{{asset('Resources/src/js/menu_movil.js')}}"></script>
    <script  src="{{asset('Resources/AdminLTE-2.3.0/bootstrap/js/bootstrap.min.js')}}"></script>

    <script type="text/javascript">

                                        function enviar()
                                        {

                                            if ($('#txtnombre').val() !== null && $("#txtapellido").val() !== "" && $("#correoEmpresa").val() !== "" && ($("#contrasenha").val() !== ""))
                                            {
                                                $("#frmEmpresaUsuarioPersona").submit(
                                                        function (event) {
                                                            $("#bntenviar").button('loading');
                                                            $("#bntenviar").prop("disabled", true);
                                                            $.ajax({
                                                                data: {dato: $("#frmEmpresaUsuarioPersona").serialize()},
                                                                url: Routing.generate('validar_correo'),
                                                                type: 'POST',
                                                                dataType: 'json',
                                                                success: function (data) {

                                                                    console.log(data.data);
                                                                    if (data.data == true) {
                                                                        //Ajax de insersion de datos               
                                                                        $.ajax({
                                                                            data: {dato: $("#frmEmpresaUsuarioPersona").serialize()},
                                                                            url: Routing.generate('ingresar_usuarioEmpresa'),
                                                                            type: 'POST',
                                                                            dataType: 'json',
                                                                            success: function (data)
                                                                            {
                                                                                console.log(data.estado);

                                                                                if (data.estado == true) {

                                                                                    var url = Routing.generate('confirma_cuenta');
                                                                                    ///        var url = Routing.generate('perfil');
                                                                                    //var url = Routing.generate('abogado_login');
                                                                                    window.open(url, "_self");
                                                                                    Lobibox.notify("success", {
                                                                                        size: 'mini',
                                                                                        msg: 'Registro exitoso, espere un momento5555'
                                                                                    });
                                                                                } else {

                                                                                    Lobibox.notify("error", {
                                                                                        size: 'mini',
                                                                                        msg: 'Error al ingresar los datos'
                                                                                    });
                                                                                }

                                                                                $("#bntenviar").prop("disabled", false);
                                                                                $("#bntenviar").button('reset');

                                                                                return false;
                                                                            }
                                                                        });
                                                                    } else {
                                                                        Lobibox.notify("error", {
                                                                            size: 'mini',
                                                                            msg: 'Correo ya existente, intenete con otro sdbhjbwjdbwhwb.'
                                                                        });
                                                                        $("#bntenviar").prop("disabled", false);
                                                                        $("#bntenviar").button('reset');
                                                                    }
                                                                }
                                                            });
                                                            event.preventDefault();
                                                        });

                                            }

                                        }
    </script>
             <script>
  // This is called with the results from from FB.getLoginStatus().
  
                function statusChangeCallback(response) {
            
                  // The response object is returned with a status field that lets the
                  // app know the current login status of the person.
                  // Full docs on the response object can be found in the documentation
                  // for FB.getLoginStatus().
                  if (response.status === 'connected') {
                      console.log(response);
                    var contrasenhaFacebook= response.authResponse.userID;
                      
                  
                  
                    //Aqui viene el dato de la  utorizacion
                    testAPI();
                     FB.api('/me/permissions', function(response) {
                                {#  console.log(JSON.stringify(response));#}
                            });

                     FB.api('/me', { locale: 'en_US', fields: 'last_name, first_name, email' },
                      function(response) {
                            var correoFeacebook=response.email;
                            var nombres= response.first_name;
                            var apellido = response.last_name;
                           
                          
                                                 $.ajax({
                                                                            data: {contrasenhaFacebook:contrasenhaFacebook},
                                                                            url: Routing.generate('validacion_permiso_login_facebook'),
                                                                            type: 'POST',
                                                                            dataType: 'json',
                                                                            success: function (data)
                                                                            {
                                                                               
                                                                                if (data.estado == false) {
                                                                                    
                                                                                      swal({
                                                                            title: "Sesión de facebook iniciada",
                                                                            text: "Ya te encuentras con tu sesion de facebook iniciada, ¿quieres registrarte dentro de la plataforma de  abogados con tu cuenta de facebook?",
                                                                            type: "info",
                                                                            showCancelButton: true,
                                                                            cancelButtonText: "No",
                                                                            confirmButtonText: "Si",
                                                                            confirmButtonColor: "#00A59D",
                                                                            closeOnConfirm: true,
                                                                            closeOnCancel: true
                                                                        },
                                                        function (isConfirm) {
                                                            if (isConfirm) {
                                                            $("#bntenviar").button('disabled',true);
                                                            $("#bntenviar").prop("disabled", true);
                                                         
                                                              $.ajax({
                                                                data: {correoFeacebook:correoFeacebook},
                                                                url: Routing.generate('validar_correo'),
                                                                type: 'POST',
                                                                dataType: 'json',
                                                                success: function (data) {

                                                                    console.log(data.data);
                                                                    if (data.data == true) {
                                                                        //Ajax de insersion de datos               
                                                                        $.ajax({
                                                                            data: {nombres:nombres,apellido:apellido,contrasenhaFacebook:contrasenhaFacebook,correoFeacebook:correoFeacebook},
                                                                            url: Routing.generate('ingresar_usuarioEmpresa'),
                                                                            type: 'POST',
                                                                            dataType: 'json',
                                                                            success: function (data)
                                                                            {
                                                                                console.log(data.estado);

                                                                                if (data.estado == true) {
                                                                                    var md5= data.md5;
                                                                                    var url = Routing.generate('confirmarcorreo',{id:md5});
                                                                                    window.open(url, "_self");
                                                                                    Lobibox.notify("success", {
                                                                                        size: 'mini',
                                                                                        msg: 'Registro exitoso, espere un momento5555'
                                                                                    });
                                                                                } else {

                                                                                    Lobibox.notify("error", {
                                                                                        size: 'mini',
                                                                                        msg: 'Error al ingresar los datos'
                                                                                    });
                                                                                }

                                                                                $("#bntenviar").prop("disabled", false);
                                                                                $("#bntenviar").button('reset');

                                                                                return false;
                                                                            }
                                                                        });
                                                                    } else {
                                                                        Lobibox.notify("error", {
                                                                            size: 'mini',
                                                                            msg: 'Correo ya existente, intenete con otro sdbhjbwjdbwhwb.'
                                                                        });
                                                                        $("#bntenviar").prop("disabled", false);
                                                                        $("#bntenviar").button('reset');
                                                                    }
                                                                }
                                                          });


                                                                              } else {
                                                                
                                                                
                                                                
                                                                                              }
                                                            
                                                            
                                                                                         });
                                                                                    
         
                                                                                }else{
                                                                                    console.log("Usuario de facebook ya existe dentro del sistema");
                                                                                }
                                                                    }
                                                        });

                            
                           

                                            }
                                      );



                  } else if (response.status === 'not_authorized') {

                    

                  }
                  else if (response.status === 'unknown') {

                        alert("No estas conectado");

                  }else {
                      FB.login();
                  }
                }

  // This function is called when someone finishes with the Login
  // Button.  See the onlogin handler attached to it in the sample
  // code below.
  function checkLoginState() {
    FB.getLoginStatus(function(response) {
      statusChangeCallback(response);
    });
  }

  window.fbAsyncInit = function() {
  FB.init({
    appId      : '1057084397714243',
    cookie     : true,  // enable cookies to allow the server to access 
                        // the session
    xfbml      : true,  // parse social plugins on this page
    version    : 'v2.5' // use version 2.2
  });

  // Now that we've initialized the JavaScript SDK, we call 
  // FB.getLoginStatus().  This function gets the state of the
  // person visiting this page and can return one of three states to
  // the callback you provide.  They can be:
  //
  // 1. Logged into your app ('connected')
  // 2. Logged into Facebook, but not your app ('not_authorized')
  // 3. Not logged into Facebook and can't tell if they are logged into
  //    your app or not.
  //
  // These three cases are handled in the callback function.

  FB.getLoginStatus(function(response) {
    statusChangeCallback(response);
  });

  };

  // Load the SDK asynchronously
  (function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "https://connect.facebook.net/en_US/sdk.js";
    fjs.parentNode.insertBefore(js, fjs);
  }(document, 'script', 'facebook-jssdk'));

  // Here we run a very simple test of the Graph API after login is
  // successful.  See statusChangeCallback() for when this call is made.
  function testAPI() {
   
    FB.api('/me', function(response) {
     
    });
  }
</script>

    
    
    
    
    
    
    
    
    
    
    
{% endblock %}
{% endblock %}
