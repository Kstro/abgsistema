{% extends ':Layout:layout3.html.twig' %}
{% block js_extend %}
    <link rel="stylesheet" href="{{ asset('Resources/AdminLTE-2.3.0/dist/css/AdminLTE.min.css') }}">
        <link rel="stylesheet" href="{{ asset('Resources/lobibox-master/dist/css/lobibox.min.css')}}">
    <script src="{{ asset('Resources/lobibox-master/dist/js/lobibox.min.js') }}"></script>
    <link rel="stylesheet" href="{{ asset('Resources/lobibox-master/dist/css/lobibox.min.css')}}">
      <script src="{{ asset('Resources/AdminLTE-2.3.0/dist/js/app.js') }}" type="text/javascript"></script>
    <script src="//cdn.tinymce.com/4/tinymce.min.js"></script>
    <script type="text/javascript">
        tinymce.init({
            selector: 'textarea',
            height: 500,
            plugins: ['advlist autolink lists link image charmap print preview anchor', 'searchreplace visualblocks code fullscreen', 'insertdatetime media table contextmenu paste code'],
            toolbar: 'insertfile undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image',
            content_css: ['//fast.fonts.net/cssapi/e6dc9b99-64fe-4292-ad98-6974f93cd2a2.css', '//www.tinymce.com/css/codepen.min.css']
        });
    </script>
    <script>
        function mostrarImagen(input) {
            if (input.files && input.files[0]) {
                var reader = new FileReader();
                reader.onload = function (e) {
                    $('#img_destino').attr('src', e.target.result);
                }
                reader.readAsDataURL(input.files[0]);
            }
        }

        $("#file").change(function () {
            mostrarImagen(this);
        });
    </script>

    <script>
        //Este es el codigo que me permite enviar la imagen con todo!!

        $(document).on("submit", "#endatos", function (e) {
            //alert("asdasd");
            e.preventDefault();
            //informaci√≥n del formulario
            var frm = new FormData($(this)[0]);
            //console.log(frm);      
        {#if (flag != false) {#}
                if (1 == 1) {
                    console.log('aqui llega');
                    $.ajax({
                        data: frm,
                        url: Routing.generate('ingresar_entrada'),
        {#url: {{path('ingresar_entrada')}},   #}             
                        type: 'POST',
                        //necesario para subir archivos via ajax
                        cache: false,
                        contentType: false,
                        processData: false,
                        //una vez finalizado correctamente

                        success: function (data) {
                            //console.log(data);
                            data = jQuery.parseJSON(data);//convirtiendo datos
                            Lobibox.notify("success", {
                                size: 'mini',
                                msg: "<p>Los datos fueron ingresados correctamente.</p>"
                            });
                            // alert("Los datos fueron ingresados correctamente");
                             var url = Routing.generate('perfil');
                             window.open(url, '_self');
            

                            //return $this->redirect($this->generateUrl('entrada_index'));

                        }
                    });

                } else {
                    var mensaje = "Los Datos no pueden ser Guardados. Formato de imagen no admitido";
                    GetAlert("Error", mensaje, "../recursos/imagenes/error.png", 4000);
                    
          
                }
            });
        


    </script>

{% endblock %} 
{% block cuerpo %}
    {% for datos in abgPersona %}
        <header class="main-header">
        {% embed ':Layout:encabezado.html.twig' %}{% endembed %}
    </header>
    <!-- Left side column. contains the sidebar -->
    <aside class="main-sidebar">
    {% embed ':Layout:barra_lateral_principal.html.twig' %}{% endembed %}
</aside>
<!-- Content Wrapper. Contains page content -->
<div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <section class="content-header">
    </section>
    <!-- Main content -->
    <section >
        <div class="row" style=" margin-left:15px; margin-right:15px; ">
            <div class="box box-widget">
                <div class="box-header with-border">
                    <h3 class="box-title">ENTRADA DE BLOG </h3>
                </div>
                <div class="box-body">
                    <form role="form" id="endatos">
                        <div class="form-group">
                            <label for="nombreEmpleado">Titulo de la entrada</label>
                            <input type="text" value="" class="form-control" id="txttitulo" name="titulo"
                                   placeholder="Titulo de la entrada">
                        </div>
                        <div class="form-group">
                            <label for="exampleInputEmail1">Contenido de la entrada</label>
                            <textarea name="contenido" class="form-control" rows="3" placeholder="Ingrese el contenido de la entrada..." ></textarea>
                        </div>

                        <div class="form-group">
                            <label for="nombreEmpleado">Categoria de la entrada</label>

                            <select class="form-control" id="categoria" name="categoria" placeholder=categoria">
                                <option value="5" selected style="margin-bottom: 10px;">Seleccione una categoria</option>                           
                                {% for ctlCategoriasBlog in ctlCategoriasBlog %}
                                    <option value="{{ ctlCategoriasBlog.id  }}">{{ctlCategoriasBlog.nombreCategoria }}</option>  
                                {% endfor %}          
                            </select>    
                        </div>

                        <div class="form-group">
                            <img id="img_destino" src="http://placehold.it/900x300" style="max-width: 100%; width: 100%; margin-top: 30px;">

                        </div>
                        <input id="file" type="file" name="file">
                        <br>
                        <button type="submit" class="btn btn-primary btn-sm">Enviar</button>
                        <button type="reset" class="btn btn-default btn-sm">Canselar</button>
                    </form>
                </div>

            </div>
        </div>
    </section>
</div>
<footer class="main-footer">
    <div class="pull-right hidden-xs">
        <b>Version</b> 1.0
    </div>
    <strong>Copyright &copy; 2016 <a href="#">Monkey Systems</a>.</strong> Todos los derechos reservados.
</footer>
<aside class="control-sidebar control-sidebar-dark">
    <!-- Ajuste -->
</aside>
<div class="control-sidebar-bg"></div>
{%endfor%}
{% endblock %}
